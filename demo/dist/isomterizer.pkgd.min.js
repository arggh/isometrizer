!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Isometrizer=e()}(this,function(){"use strict";var t,o="Orientation is not correctly specified for Isometrizer",e="Values for matrix is not provided",i=(t=l.prototype,Object.defineProperty(l,"ZERO",{get:function(){return new l([0,0,0,0,0,0,0,0,0])},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ONE",{get:function(){return new l([1,0,0,0,1,0,0,0,1])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"values",{get:function(){return this._values},enumerable:!0,configurable:!0}),t.mul=function(t){if(!(t instanceof l))throw new Error("Multiplyee for matrix should be another matrix");return this._multiply3x3(t),this},t.rotateX=function(t){var e=this._degToRad(t),i=Math.cos(e),r=Math.sin(e),n=new l([1,0,0,0,i,-r,0,r,i]);this.mul(n)},t.rotateY=function(t){var e=this._degToRad(t),i=Math.cos(e),r=Math.sin(e),n=new l([i,0,r,0,1,0,-r,0,i]);this.mul(n)},t.rotateZ=function(t){var e=this._degToRad(t),i=Math.cos(e),r=Math.sin(e),n=new l([i,-r,0,r,i,0,0,0,1]);this.mul(n)},t.scale=function(t){void 0===t&&(t={x:1,y:1,z:1});var e=t.x||1,i=t.y||1,r=t.z||1;this._values[0]*=e,this._values[4]*=i,this._values[8]*=r},t.toString4x4=function(){var t=[this._values[0],this._values[3],this._values[6],this._values[1],this._values[4],this._values[7],this._values[2],this._values[5],this._values[8]].map(function(t){return t.toFixed(4)});return t[0]+", "+t[1]+", "+t[2]+", 0, "+t[3]+", "+t[4]+", "+t[5]+", 0, "+t[6]+", "+t[7]+", "+t[8]+", 0, 0, 0, 0, 1"},t.match=function(t){for(var e=!0,i=0;i<this._values.length;i+=1)if(this._values[i]!==t._values[i]){e=!1;break}return e},t._multiply3x3=function(t){for(var e=l.ZERO,i=0;i<9;i+=1)for(var r=Math.floor(i/3),n=i%3,s=0;s<3;s+=1){var o=3*s+n,a=3*r+s;e.values[i]+=this._values[o]*t._values[a]}this._values=e.values},t._degToRad=function(t){return t*Math.PI/180},l);function l(t){if(!t)throw new Error(e);if(!t.length)throw new Error(e);if(9!==t.length)throw new Error(e);this._values=t}var r,n=Math.sqrt(2),s=Math.sqrt(3),_=(r=a.prototype,a.fromString=function(t){var e=t.split("|").map(function(t){var e=t.trim();return function(t){switch(t){case"vertical":return new a(4);case"horizontal":return new a(8);case"left":return new a(1);case"right":return new a(2);default:throw new Error(o)}}(e=e.toLowerCase())});if(e.length<0)throw new Error(o);for(var i=new a(0),r=0,n=e;r<n.length;r++){var s=n[r];i.merge(s)}return i},Object.defineProperty(r,"isLeft",{get:function(){return 0<(1&this._val)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"isRight",{get:function(){return 0<(2&this._val)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"isHorizontal",{get:function(){return 0<(8&this._val)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"isVertical",{get:function(){return 0<(4&this._val)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"isSide",{get:function(){return 0<(3&this._val)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"isNormal",{get:function(){return 0<(12&this._val)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"normal",{get:function(){return new a(12&this._val)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"side",{get:function(){return new a(3&this._val)},enumerable:!0,configurable:!0}),r.checkMutualExclusion=function(){if(this.isHorizontal===this.isVertical||this.isLeft===this.isRight)throw Error(o)},r.has=function(t){return 0<(this._val&t._val)},r.match=function(t){return this._val===t._val},r.merge=function(t){this._val=this._val|t._val},a);function a(t){if(t<0||15<t)throw Error(o);this._val=t}var h,f=(h=u.prototype,Object.defineProperty(h,"changed",{get:function(){return!(this._matrix.match(i.ONE)&&0===this._float)},enumerable:!0,configurable:!0}),h.rotateTo=function(t){var e=t.normal,i=t.side,r=e*this._rotationDegree.normal.z+i*this._rotationDegree.side.z,n=e*this._rotationDegree.normal.y+i*this._rotationDegree.side.y,s=e*this._rotationDegree.normal.x+i*this._rotationDegree.side.x;this._matrix.rotateZ(r),this._matrix.rotateY(n),this._matrix.rotateX(s)},h.toString=function(){return this.changed?"matrix3d("+this._matrix.toString4x4()+") translateZ("+this._float.toFixed(4)+"px)":"none"},h.setScale=function(t){this._matrix.scale({x:t,y:t,z:t})},h.setFloat=function(t){this._float=t},h.reset=function(){this._matrix=i.ONE},h._calcRotationDegree=function(t,e){var i={normal:{x:0,y:0,z:0},side:{x:0,y:0,z:0}};return t.match(new _(0))||(e.match(new _(0))?(i.normal.x=t.isHorizontal?55:-35,t.isVertical?i.side.y=t.isLeft?-45:45:i.side.z=t.isLeft?45:-45):e.isHorizontal?t.isHorizontal?i.side.z=e.isRight?90:-90:(i.normal.x=-90,e.side.match(t.side)||(i.side.y=e.isRight?-90:90)):e.isVertical&&(t.isVertical?i.side.y=e.isRight?-90:90:(i.normal.x=90,e.side.match(t.side)||(i.side.z=e.isRight?90:-90)))),i},u);function u(t,e){this._rotationDegree=this._calcRotationDegree(t,e),this._matrix=i.ONE,this._float=0}var c,g=(c=p.prototype,Object.defineProperty(c,"offset",{get:function(){return this._offset},enumerable:!0,configurable:!0}),Object.defineProperty(c,"background",{set:function(t){this._element.style.background=t},enumerable:!0,configurable:!0}),c.progress=function(t,e,i){this._length=Number((t*this._maxLength).toFixed(4));var r=this._length*e*.8112;i.isHorizontal?this._offset.bottom=r:(this._offset.top=r/2,this._offset.left=i.isRight?s*r/2:0,this._offset.right=i.isLeft?s*r/2:0)},c.update=function(){var t=1,e=1;this._orientation.isVertical?t=this._length/this._maxLength:e=this._length/this._maxLength,this._element.style.transform="translateZ("+-this._length+"px) "+this._rotation+" scale("+t+", "+e+")"},p);function p(t,e,i){this._length=0,this._maxLength=e,this._orientation=i,t.style.transformStyle="preserve-3d",this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.backfaceVisibility="hidden",this._orientation.isHorizontal?(this._element.style.width="100%",this._element.style.height=this._maxLength+"px"):(this._element.style.width=this._maxLength+"px",this._element.style.height="100%"),this._orientation.isHorizontal&&this._orientation.isRight?this._element.style.bottom="0":this._element.style.top="0",this._orientation.isVertical&&this._orientation.isRight?this._element.style.right="0":this._element.style.left="0";var r=50,n=50;this._orientation.isHorizontal?(n=this._orientation.isLeft?0:100,this._rotation=this._orientation.isLeft?"rotateX(90deg)":"rotateX(-90deg)"):(r=this._orientation.isLeft?0:100,this._rotation=this._orientation.isLeft?"rotateY(-90deg)":"rotateY(90deg)"),this._element.style.transformOrigin=r+"% "+n+"%",t.appendChild(this._element),this._offset={top:0,bottom:0,left:0,right:0}}function d(t,e){void 0===e&&(e=!1);var i=document.createElement("div"),r=getComputedStyle(t),n=0<navigator.userAgent.indexOf("Firefox");return"absolute"===r.position||"fixed"===r.position?(i.style.position=r.position,i.style.top=r.top,i.style.left=r.left):i.style.position="relative","inline"!==r.display&&"content"!==r.display&&"unset"!==r.display&&(i.style.display=r.display),i.style.backfaceVisibility="hidden",i.style.overflow="visible",i.style.willChange="transform",i.style.pointerEvents=r.pointerEvents,function(t,e){var i=t.getBoundingClientRect();e.style.width=i.width+"px",e.style.height=i.height+"px"}(t,i),t.parentElement.replaceChild(i,t),i.appendChild(t),e||(t.style.transformStyle="preserve-3d"),t.style.overflow="visible",n||(t.style.willChange="transform"),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="0",i}function m(t){return[].slice.call(t)}var v,y,b=(v=w.prototype,Object.defineProperty(v,"orientation",{get:function(){return this._orientation},enumerable:!0,configurable:!0}),Object.defineProperty(v,"wrapper",{get:function(){return this._wrapper},enumerable:!0,configurable:!0}),v.progress=function(t,e,i,r,n){this._transform.reset(),this._transform.setFloat(t*this._spacing),this._orientation.match(this._parent.orientation)||this._transform.rotateTo({normal:e,side:i});for(var s={top:0,bottom:0,left:0,right:0},o=0,a=this._panels;o<a.length;o++){var l=a[o];l.progress(t,r,this._orientation);var h=l.offset;s.top=s.top||h.top,s.bottom=s.bottom||h.bottom,s.left=s.left||h.left,s.right=s.right||h.right}var f=this._element.getBoundingClientRect();f.top-s.top<n.top&&(n.top=f.top-s.top),f.bottom+s.bottom>n.bottom&&(n.bottom=f.bottom+s.bottom),f.left-s.left<n.left&&(n.left=f.left-s.left),f.right+s.right>n.right&&(n.right=f.right-s.right);for(var u=0,c=this._childs;u<c.length;u++)c[u].progress(t,e,i,r,n)},v.update=function(){0<navigator.userAgent.indexOf("Firefox")?this._wrapper.style.transformStyle="preserve-3d":this._isLeaf&&(this._transform.changed?this._wrapper.style.transformStyle="preserve-3d":this._wrapper.style.transformStyle="flat"),this._wrapper.style.transform=this._transform.toString();for(var t=0,e=this._panels;t<e.length;t++)e[t].update()},v.addParallelLayer=function(t){this._wrapper.appendChild(t.wrapper),this._childs.push(t)},v.getAllChildLayers=function(){for(var t=[],e=0,i=this._childs;e<i.length;e++){var r=i[e];t.push(r),t.push.apply(t,r.getAllChildLayers())}return t},v._makePanel=function(){var t=this._element,e=this._spacing,i=this._orientation,r=t.getAttribute("iso-top-background"),n=t.getAttribute("iso-side-background"),s=t.getAttribute("iso-side-length"),o=null!==r||null!==n||null!==s,a=s?Number(s):Number(e),l=[];if(o){r=r||"lightgrey",n=n||"grey";var h=i.isHorizontal?new _(10):new _(9),f=i.isLeft?new _(6):new _(5),u=new g(t,a,h),c=new g(t,a,f);u.background=r,c.background=n,l.push(u),l.push(c)}return l},v._findChilds=function(t){var e=null!==this._element.getAttribute("iso-parallel");if(this._element.children[0])if(e){var i=new w(this._element.children[0],this,t);for(this._childs.push(i);this._element.children[1];){var r=new w(this._element.children[1],i,t);i.addParallelLayer(r),i=r}}else for(var n=0,s=m(this._element.children);n<s.length;n++)r=new w(s[n],this,t),this._childs.push(r)},v._shouldTraverse=function(){var t=this._element.tagName.toLowerCase();return!this._isWrapper&&!this._isLeaf&&"a"!==t&&"iframe"!==t},v._setTransformOrigin=function(){var t=this._orientation,e=this._parent.orientation,i=0,r=0;e.isVertical&&e.isLeft&&(i=100),e.isHorizontal&&(r=t.isHorizontal?i=50:(i=e.isRight?100:0,100)),this._wrapper.style.transformOrigin=i+"% "+r+"%"},w);function w(t,e,i){this._element=t,this._parent=e,this._childs=[],this._orientation=e.orientation;var r=t.getAttribute("iso-wrap-spacing");if(this._isWrapper=null!==r,this._isLeaf=null!==t.getAttribute("iso-no-spacing")||this._isWrapper,this._isWrapper)this._spacing=Number(r)||i;else if(this._isLeaf)this._spacing=0;else{var n=t.getAttribute("iso-spacing");this._spacing=null!==n?Number(n):i}var s=t.getAttribute("iso-rotation");null!==s&&(this._orientation=_.fromString(s),this._orientation.isNormal||this._orientation.merge(e.orientation.normal),this._orientation.isSide||this._orientation.merge(e.orientation.side)),this._transform=new f(this._orientation,this._parent.orientation),this._wrapper=d(this._element,this._isLeaf),this._isLeaf||(this._wrapper.style.transformStyle="preserve-3d"),this._setTransformOrigin(),this._shouldTraverse()&&this._findChilds(i),this._childs.length<=0&&(this._isLeaf=!0),this._panels=this._makePanel()}function x(t,e){void 0===e&&(e={spacing:40,orientation:6}),this._element=function(t){if("string"==typeof t)return document.querySelector(t);if(0<t.nodeType)return t;throw new Error("Element selector is not specified")}(t),this._prevProgress={normal:0,side:0,scale:0,float:0,childNormal:0,childSide:0},this._defaultSpacing=e.spacing||40,this._orientation=new _(e.orientation||6),this._wrapper=d(this._element),this._element.style.transformStyle="preserve-3d",this._wrapper.style.willChange="transform",this._layers=this._findLayers(),this._allLayers=this._getAllLayers(),this.off()}return y=x.prototype,Object.defineProperty(x,"ISO_LEFT",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(x,"ISO_RIGHT",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(x,"ISO_HORIZONTAL",{get:function(){return 8},enumerable:!0,configurable:!0}),Object.defineProperty(x,"ISO_VERTICAL",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(y,"orientation",{get:function(){return this._orientation},enumerable:!0,configurable:!0}),y.on=function(){return this.progress({normal:1,side:1,scale:1,float:1,childNormal:1,childSide:1}),this},y.off=function(){return this.progress({normal:0,side:0,scale:0,float:0,childNormal:0,childSide:0}),this},y.progress=function(t){void 0===t&&(t=this._prevProgress),t.normal=t.normal||this._prevProgress.normal,t.side=t.side||this._prevProgress.side,t.scale=t.scale||this._prevProgress.scale,t.float=t.float||this._prevProgress.float,t.childNormal=t.childNormal||this._prevProgress.childNormal,t.childSide=t.childSide||this._prevProgress.childSide;var e=.001;t.normal<e&&(t.normal=0),t.side<e&&(t.side=0),t.scale<e&&(t.scale=0),t.float<e&&(t.float=0),t.childNormal<e&&(t.childNormal=0),t.childSide<e&&(t.childSide=0);for(var i=this._wrapper.getBoundingClientRect(),r=this._element.getBoundingClientRect(),n={top:r.top,bottom:r.bottom,left:r.left,right:r.right},s=this._calcScale(t.scale),o=0,a=this._layers;o<a.length;o++)a[o].progress(t.float,t.childNormal,t.childSide,s,n);this._rotate({normal:t.normal,side:t.side,scale:t.scale});for(var l=0,h=this._allLayers;l<h.length;l++)h[l].update();return this._resize(i,n),this._prevProgress.normal=t.normal,this._prevProgress.side=t.side,this._prevProgress.scale=t.scale,this._prevProgress.float=t.float,this._prevProgress.childNormal=t.childNormal,this._prevProgress.childSide=t.childSide,this},y._resize=function(t,e){e.width=e.right-e.left,e.height=e.bottom-e.top;var i=this._wrapper,r=t.top-e.top,n=e.bottom-t.bottom,s=t.left-e.left,o=e.right-t.right,a=Math.max(s,0)-Math.max(o,0),l=Math.max(s+(o<0?o:0),0),h=Math.max(o+(s<0?s:0),0);i.style.marginRight=l+"px",i.style.marginLeft=h+"px",i.style.marginTop=r+"px",i.style.marginBottom=n+"px",i.style.transform="translateX("+a+"px)"},y._findLayers=function(){for(var t=[],e=0,i=m(this._element.children);e<i.length;e++){var r=i[e],n=new b(r,this,this._defaultSpacing);t.push(n)}return t},y._getAllLayers=function(){for(var t=[],e=0,i=this._layers;e<i.length;e++){var r=i[e];t.push(r),t.push.apply(t,r.getAllChildLayers())}return t},y._rotate=function(t){var e=t.normal,i=t.side,r=t.scale,n=new f(this._orientation,new _(0));n.setScale(this._calcScale(r)),n.rotateTo({normal:e,side:i}),this._element.style.transform=n.toString()},y._calcScale=function(t){return 1+t*(n-1)},x});
//# sourceMappingURL=isomterizer.pkgd.min.js.map
